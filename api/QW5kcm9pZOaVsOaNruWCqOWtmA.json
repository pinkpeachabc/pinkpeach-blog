{"title":"Android数据储存","date":"2019-12-31T14:40:26.000Z","date_formatted":{"ll":"2019年12月31日","L":"2019/12/31","MM-DD":"12-31"},"link":"Android数据储存","comments":true,"tags":["Android"],"categories":["Android学习"],"updated":"2020-01-31T12:03:25.000Z","content":"<p>大部分应用程序都会涉及数据储存方式，Android程序也不例外。Android中的数据储存方式有五种。分别为文件储存、SharedPreferences、SQLite数据库、ContentProvider以及网络储存。根据程序适配的Android SDK版本不同，申请权限分为两种，分别为静态申请和动态申请权限，这次主要讲怎么申请和遇到过的坑。</p>\n<span id=\"more\"></span>\n<h2 id=\"文件储存遇到的坑\">文件储存遇到的坑<a title=\"#文件储存遇到的坑\" href=\"#文件储存遇到的坑\"></a></h2>\n<blockquote>\n<p>由于Android版本的更新，和现在的手机几乎不再使用SD卡。导致初学者在用这个方法的时候就会出现问题。</p>\n</blockquote>\n<p>在文件存储中分为内部储存和外部储存，出坑的主要是外部储存。在eclipse中可以正常写入可到了Android stuido中却写入不进去。</p>\n<p>首先，若使用外部存储需要先设置外部存储的<strong>读写权限</strong>，若是不添加将无法写入。</p>\n<h2 id=\"静态申请权限\">静态申请权限<a title=\"#静态申请权限\" href=\"#静态申请权限\"></a></h2>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;uses-permission android:name=<span class=\"string\">&quot;android.permission.WRITE_EXTERNAL_STORAGE&quot;</span> /&gt;</span><br><span class=\"line\">&lt;uses-permission android:name=<span class=\"string\">&quot;android.permission.READ_EXTERNAL_STORAGE&quot;</span> /&gt;</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>此方式只适应于Android SDK6.0以下的版本，当大于这个版本的时候就需要添加动态申请权限了。</p>\n</blockquote>\n<h2 id=\"动态申请权限\">动态申请权限<a title=\"#动态申请权限\" href=\"#动态申请权限\"></a></h2>\n<p>这时候需要新建PermisionUtils类内容如下，最后在需要的地方调用这个类。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">class</span> <span class=\"title class_\">PermisionUtils</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// Storage Permissions</span></span><br><span class=\"line\">        <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"type\">int</span> <span class=\"variable\">REQUEST_EXTERNAL_STORAGE</span> <span class=\"operator\">=</span> <span class=\"number\">1</span>;</span><br><span class=\"line\">        <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> String[] PERMISSIONS_STORAGE = &#123;</span><br><span class=\"line\">                Manifest.permission.READ_EXTERNAL_STORAGE,</span><br><span class=\"line\">                Manifest.permission.WRITE_EXTERNAL_STORAGE&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">verifyStoragePermissions</span><span class=\"params\">(Activity activity)</span> &#123;</span><br><span class=\"line\">            <span class=\"comment\">// Check if we have write permission</span></span><br><span class=\"line\">            <span class=\"type\">int</span> <span class=\"variable\">permission</span> <span class=\"operator\">=</span> ActivityCompat.checkSelfPermission(activity,</span><br><span class=\"line\">                    Manifest.permission.WRITE_EXTERNAL_STORAGE);</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (permission != PackageManager.PERMISSION_GRANTED) &#123;</span><br><span class=\"line\">                <span class=\"comment\">// We don&#x27;t have permission so prompt the user</span></span><br><span class=\"line\">                ActivityCompat.requestPermissions(activity, PERMISSIONS_STORAGE,</span><br><span class=\"line\">                        REQUEST_EXTERNAL_STORAGE);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">PermisionUtils.verifyStoragePermissions(<span class=\"built_in\">this</span>);</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>这个时候在这个时候在点击写入便会出现以下界面：</p>\n</blockquote>\n<p><img src=\"https://tva1.sinaimg.cn/large/006tNbRwly1gagbsv7y8dj30dy0o0ju8.jpg\" alt=\"屏幕快照 2019-12-31 下午11.14.51\" loading=\"lazy\" class=\"φbp\"></p>\n<blockquote>\n<p>这时候我本以为可以直接读出来我写入的内容了，但我还是太年轻了。我还是读取不出来。这个点困扰我很长时间知道我发现了手机里有一个应用访问授权。<strong>一定要把它打开！！！</strong></p>\n</blockquote>\n<p><img src=\"https://tva1.sinaimg.cn/large/006tNbRwly1gagc0hdlymj30dy0o00ur.jpg\" alt=\"屏幕快照 2019-12-31 下午11.16.01\" loading=\"lazy\" class=\"φbp\"></p>\n<blockquote>\n<p>最后完美读出</p>\n</blockquote>\n<p><img src=\"https://tva1.sinaimg.cn/large/006tNbRwly1gagc1el2e0j30dy0o0q5x.jpg\" alt=\"屏幕快照 2019-12-31 下午11.16.01\" loading=\"lazy\" class=\"φbp\"></p>\n","prev":{"title":"Blog搭建流程","link":"Blog搭建流程"},"next":{"title":"hexo速度优化，gulp压缩静态资源","link":"hexo速度优化，gulp压缩静态资源"},"plink":"https://pinkpeachabc.cn/Android数据储存/","toc":[{"id":"文件储存遇到的坑","title":"文件储存遇到的坑","index":"1"},{"id":"静态申请权限","title":"静态申请权限","index":"2"},{"id":"动态申请权限","title":"动态申请权限","index":"3"}],"reward":true,"copyright":{"author":"PinkPeach","link":"<a href=\"https://pinkpeachabc.cn/Android数据储存/\" title=\"Android数据储存\">https://pinkpeachabc.cn/Android数据储存/</a>","license":"Attribution-NonCommercial-NoDerivatives 4.0 International (<a href=\"https://creativecommons.org/licenses/by-nc-sa/4.0/\" rel=\"external nofollow noopener\" target=\"_blank\">CC BY-NC-ND 4.0</a>)"}}